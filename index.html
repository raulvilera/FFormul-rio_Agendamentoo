<!DOCTYPE html>
<html lang="pt-br">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>AGENDAMENTO DE APARELHOS</title>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.5.28/jspdf.plugin.autotable.min.js"></script>
  <style>
    :root {
      --azul-escuro: #0a2463;
      --azul-medio: #3e92cc;
      --azul-claro: #d6eaff;
      --verde: #4caf50;
      --vermelho: #f44336;
      --cinza-escuro: #333;
      --cinza-claro: #f5f5f5;
      --branco: #ffffff;
      --branco-brilhante: rgba(255, 255, 255, 0.9);
      --verde-disponivel: #2ecc71;
      --azul-agendado: #3498db;
      --azul-selecionado: #1a5276;
      --fundo-cinza: #f0f0f0;
      --entregue: #d4edda;
      --nao-entregue: #f8d7da;
      --expirado: #fff3cd;
      --recente: #ffebee;
    }
    
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
      font-family: 'Poppins', sans-serif;
    }

    body {
      background: linear-gradient(to bottom, var(--azul-escuro) 0%, var(--azul-escuro) 50%, #111 50%, #111 100%);
      color: var(--cinza-claro);
      min-height: 100vh;
      padding: 20px;
    }

    h2 {
      color: var(--branco);
      margin-bottom: 20px;
      text-align: center;
      text-transform: uppercase;
    }

    h3 {
      color: #000000;
      margin: 0.4cm 0;
      text-align: center;
      text-transform: uppercase;
      font-size: 0.9em;
    }

    .container {
      display: flex;
      gap: 30px;
      flex-wrap: wrap;
    }

    .form-container {
      flex: 1;
      min-width: 300px;
      background-color: rgba(255, 255, 255, 0.9);
      padding: 20px;
      border-radius: 10px;
      box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
      color: var(--cinza-escuro);
    }

    .calendar-container {
      flex: 1;
      min-width: 300px;
      background-color: rgba(255, 255, 255, 0.9);
      padding: 20px;
      border-radius: 10px;
      box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
      color: var(--cinza-escuro);
    }

    .form-row {
      display: flex;
      flex-wrap: wrap;
      gap: 20px;
      margin-bottom: 1.5rem;
    }

    .form-group {
      flex: 1;
      min-width: 220px;
      position: relative;
    }

    .form-group label {
      display: block;
      margin-bottom: 0.5rem;
      font-weight: 500;
      color: var(--azul-escuro);
    }

    .form-group input,
    .form-group select:not(#aula) {
      width: 100%;
      padding: 12px 15px;
      border: 2px solid var(--branco-brilhante);
      border-radius: 8px;
      font-size: 1rem;
      transition: all 0.3s ease;
      background-color: var(--branco);
    }

    /* Estilo específico para o campo "Aula" */
    .form-group select#aula {
      width: 120px;
      padding: 8px 10px;
    }

    .form-group input[type="time"] {
      width: 120px;
      padding: 8px 10px;
    }

    .form-group input:focus,
    .form-group select:focus {
      border-color: var(--azul-medio);
      box-shadow: 0 0 0 3px rgba(62, 146, 204, 0.2);
      outline: none;
    }

    /* Estilo para dropdown com cores alternadas */
    .form-group select option:nth-child(odd) {
      background-color: var(--azul-claro);
    }
    
    .form-group select option:nth-child(even) {
      background-color: var(--branco);
    }

    .calendar {
      width: 100%;
      border-collapse: collapse;
      margin-top: 20px;
      margin-bottom: 0.4cm;
    }

    .calendar th,
    .calendar td {
      width: 40px;
      height: 40px;
      text-align: center;
      vertical-align: middle;
      border: 1px solid var(--branco-brilhante);
      border-radius: 8px;
      box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
      background-color: var(--branco);
      padding: 10px;
    }

    .calendar th {
      background-color: var(--azul-claro);
      border: 1px solid var(--branco-brilhante);
    }

    .calendar td.disponivel {
      background-color: var(--verde-disponivel);
      color: white;
      cursor: default;
      border: 1px solid var(--branco-brilhante);
    }

    .calendar td.agendado {
      background-color: var(--azul-agendado);
      color: white;
      border: 1px solid var(--branco-brilhante);
      cursor: default;
    }

    .calendar td.selecionado {
      background-color: var(--azul-selecionado);
      color: white;
      font-weight: bold;
      border: 1px solid var(--branco-brilhante);
      cursor: default;
    }

    .calendar td.indisponivel {
      background-color: #ccc;
      cursor: not-allowed;
      color: #666;
      border: 1px solid var(--branco-brilhante);
    }

    .calendar td:hover:not(.indisponivel) {
      opacity: 0.8;
    }

    /* Estilos para a tabela de histórico */
    .historico-table {
      width: 100%;
      border-collapse: collapse;
      table-layout: fixed;
    }

    .historico-table th,
    .historico-table td {
      border: 1px solid #ccc;
      padding: 8px;
      text-align: center;
      word-wrap: break-word;
      overflow-wrap: break-word;
      font-size: 0.8em;
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
    }

    .historico-table th {
      background-color: var(--azul-claro);
      color: #000;
      font-weight: bold;
    }

    .historico-table td {
      color: #000;
    }

    .historico-table tr.excluido td {
      color: var(--vermelho);
    }

    .historico-table tr.entregue {
      background-color: var(--entregue);
    }

    .historico-table tr.nao-entregue {
      background-color: var(--nao-entregue);
    }
    
    .historico-table tr.expirado {
      background-color: var(--expirado);
    }
    
    .historico-table tr.recente {
      background-color: var(--recente);
    }

    /* Definindo larguras específicas para cada coluna */
    .historico-table th:nth-child(1),
    .historico-table td:nth-child(1) {
      width: 10%;
    }

    .historico-table th:nth-child(2),
    .historico-table td:nth-child(2) {
      width: 15%;
    }

    .historico-table th:nth-child(3),
    .historico-table td:nth-child(3) {
      width: 8%;
    }

    .historico-table th:nth-child(4),
    .historico-table td:nth-child(4) {
      width: 12%;
    }

    .historico-table th:nth-child(5),
    .historico-table td:nth-child(5) {
      width: 20%;
    }

    .historico-table th:nth-child(6),
    .historico-table td:nth-child(6) {
      width: 10%;
    }
    
    .historico-table th:nth-child(7),
    .historico-table td:nth-child(7) {
      width: 10%;
    }
    
    .historico-table th:nth-child(8),
    .historico-table td:nth-child(8) {
      width: 15%;
    }

    /* Estilos para os botões */
    .buttons-container {
      display: flex;
      gap: 10px;
      margin-top: 20px;
    }

    .btn {
      padding: 10px 20px;
      border: none;
      border-radius: 5px;
      font-weight: bold;
      cursor: pointer;
      transition: all 0.2s;
      box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
      position: relative;
      overflow: hidden;
    }

    .btn:active {
      transform: translateY(2px);
      box-shadow: 0 2px 3px rgba(0, 0, 0, 0.1);
    }

    .btn-cadastrar {
      background-color: var(--azul-medio);
      color: white;
    }

    .btn-cadastrar:hover {
      background-color: #2c7ebd;
    }

    .btn-cadastrar:active {
      box-shadow: inset 0 3px 5px rgba(0, 0, 0, 0.2);
    }

    .btn-limpar {
      background-color: #f0f0f0;
      color: #333;
    }

    .btn-limpar:hover {
      background-color: #e0e0e0;
    }

    .btn-limpar:active {
      box-shadow: inset 0 3px 5px rgba(0, 0, 0, 0.2);
    }

    .btn-excluir {
      background-color: var(--vermelho);
      color: white;
    }

    .btn-excluir:hover {
      background-color: #d32f2f;
    }

    .btn-excluir:active {
      box-shadow: inset 0 3px 5px rgba(0, 0, 0, 0.2);
    }
    
    .btn-entregar {
      background-color: var(--verde);
      color: white;
    }

    .btn-entregar:hover {
      background-color: #3d8b40;
    }

    /* Estilos para o calendário pop-up */
    .datepicker-container {
      position: relative;
    }

    .datepicker-popup {
      display: none;
      position: absolute;
      top: 100%;
      left: 0;
      z-index: 1000;
      background-color: white;
      border: 1px solid #ddd;
      border-radius: 8px;
      padding: 10px;
      box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
      width: 300px;
    }

    .datepicker-popup.active {
      display: block;
    }

    .datepicker-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 10px;
    }

    .datepicker-nav {
      background: none;
      border: none;
      font-size: 1.2rem;
      cursor: pointer;
    }

    .datepicker-title {
      font-weight: bold;
    }

    .datepicker-grid {
      display: grid;
      grid-template-columns: repeat(7, 1fr);
      gap: 5px;
    }

    .datepicker-weekday {
      text-align: center;
      font-weight: bold;
      padding: 5px;
    }

    .datepicker-day {
      text-align: center;
      padding: 5px;
      cursor: pointer;
      border-radius: 4px;
    }

    .datepicker-day:hover {
      background-color: var(--azul-claro);
    }

    .datepicker-day.selected {
      background-color: var(--azul-medio);
      color: white;
    }

    .datepicker-day.disabled {
      color: #ccc;
      cursor: not-allowed;
    }

    .datepicker-today {
      font-weight: bold;
    }

    .datepicker-other-month {
      color: #aaa;
    }

    .datepicker-input {
      cursor: pointer;
    }

    .conflict-message {
      color: var(--vermelho);
      font-weight: bold;
      margin-top: 10px;
      text-align: center;
      display: none;
    }
    
    /* Estilos para o modal de devolução */
    .modal {
      display: none;
      position: fixed;
      z-index: 1001;
      left: 0;
      top: 0;
      width: 100%;
      height: 100%;
      background-color: rgba(0, 0, 0, 0.5);
    }

    .modal-content {
      background-color: #fefefe;
      margin: 15% auto;
      padding: 20px;
      border: 1px solid #888;
      border-radius: 8px;
      width: 80%;
      max-width: 500px;
    }

    .close {
      color: #aaa;
      float: right;
      font-size: 28px;
      font-weight: bold;
      cursor: pointer;
    }

    .close:hover {
      color: black;
    }

    .modal-buttons {
      display: flex;
      justify-content: flex-end;
      gap: 10px;
      margin-top: 20px;
    }
    
    /* Estilo para o botão de exportar */
    .export-buttons {
      margin-bottom: 15px;
      display: flex;
      gap: 10px;
      justify-content: flex-end;
    }
  </style>
</head>
<body>
  <h2>AGENDAMENTO DE APARELHOS</h2>
  <div class="container">
    <div class="form-container">
      <div class="form-row">
        <div class="form-group">
          <label>PROFESSOR:</label>
          <select id="professor" onchange="atualizarEmail()">
            <option>Selecione</option>
           <option value="ADEMAR RIBEIRO DE SOUZA">ADEMAR RIBEIRO DE SOUZA</option>
<option value="ALEX LUTH PEREIRA MARANHAO">ALEX LUTH PEREIRA MARANHAO</option>
<option value="ALEXANDRE SILVA LIMA">ALEXANDRE SILVA LIMA</option>
<option value="ALEXSANDRA PAULA VARELLA DE SOUZA">ALEXSANDRA PAULA VARELLA DE SOUZA</option>
<option value="ALISON VASCONCELOS BESERRA">ALISON VASCONCELOS BESERRA</option>
<option value="AMAURI TEODORO DE OLIVEIRA">AMAURI TEODORO DE OLIVEIRA</option>
<option value="ANA PAULA DOS SANTOS">ANA PAULA DOS SANTOS</option>
<option value="ANDRE LUIZ TAVARES">ANDRE LUIZ TAVARES</option>
<option value="ANDREIA DOS SANTOS FREITAS">ANDREIA DOS SANTOS FREITAS</option>
<option value="ANDREIA MADUREIRA REIS">ANDREIA MADUREIRA REIS</option>
<option value="ANTONIO CARLOS DE OLIVEIRA">ANTONIO CARLOS DE OLIVEIRA</option>
<option value="ANTONIO RAMOS DE ARAUJO">ANTONIO RAMOS DE ARAUJO</option>
<option value="ANTONIO WILTON WANDERLEY CABRAL">ANTONIO WILTON WANDERLEY CABRAL</option>
<option value="AUGUSTO LINO PESSOA NETO">AUGUSTO LINO PESSOA NETO</option>
<option value="AUREA MARIA DE JESUS MARQUES">AUREA MARIA DE JESUS MARQUES</option>
<option value="CAROLINA PERNOMIAN PARUSSOLO">CAROLINA PERNOMIAN PARUSSOLO</option>
<option value="CASSIA OLIVEIRA ANTONIAZI">CASSIA OLIVEIRA ANTONIAZI</option>
<option value="DANIEL DE FREITAS ALMEIDA">DANIEL DE FREITAS ALMEIDA</option>
<option value="DANIEL LOPES BARBOSA">DANIEL LOPES BARBOSA</option>
<option value="DANIELA FERREIRA LIMA">DANIELA FERREIRA LIMA</option>
<option value="EDIANE VIEIRA DA SILVA">EDIANE VIEIRA DA SILVA</option>
<option value="EDILEUSA NUNES PEREIRA">EDILEUSA NUNES PEREIRA</option>
<option value="EDUARDO HENRIQUE DA FONSECA">EDUARDO HENRIQUE DA FONSECA</option>
<option value="ELIANE SANTOS SILVA">ELIANE SANTOS SILVA</option>
<option value="ELIAS MONTEIRO DA SILVA">ELIAS MONTEIRO DA SILVA</option>
<option value="ELISABETE APARECIDA PIRES">ELISABETE APARECIDA PIRES</option>
<option value="ELZA DE FARIA PEREIRA">ELZA DE FARIA PEREIRA</option>
<option value="EMERSON GABLER DE ALMEIDA">EMERSON GABLER DE ALMEIDA</option>
<option value="ERINEIDE LEITE ARAGAO NERY">ERINEIDE LEITE ARAGAO NERY</option>
<option value="EUZELI ARAUJO DE OLIVEIRA">EUZELI ARAUJO DE OLIVEIRA</option>
<option value="FABIANO AUGUSTO PIEDADE">FABIANO AUGUSTO PIEDADE</option>
<option value="FABIO CAMILO">FABIO CAMILO</option>
<option value="FERNANDO JOSE DA SILVA FILHO">FERNANDO JOSE DA SILVA FILHO</option>
<option value="FLAVIA CRISTINA APARECIDA BICHLER">FLAVIA CRISTINA APARECIDA BICHLER</option>
<option value="FLAVIO CARDOSO FLEURY">FLAVIO CARDOSO FLEURY</option>
<option value="GABRIELA SERIGHELLI DE MELO">GABRIELA SERIGHELLI DE MELO</option>
<option value="GENILTON DE OLIVEIRA SILVA">GENILTON DE OLIVEIRA SILVA</option>
<option value="GIANI CRISTINA DO PRADO">GIANI CRISTINA DO PRADO</option>
<option value="INGRYD CAROLINA SUGUIMOTO VIEIRA">INGRYD CAROLINA SUGUIMOTO VIEIRA</option>
<option value="IVANILDES DOS SANTOS OSHIKAWA">IVANILDES DOS SANTOS OSHIKAWA</option>
<option value="JANINA DOS PASSOS BRAGA DE ALMEIDA">JANINA DOS PASSOS BRAGA DE ALMEIDA</option>
<option value="JUAREZ GOMES DE MAGALHAES FILHO">JUAREZ GOMES DE MAGALHAES FILHO</option>
<option value="JUREMA SOLEDADE FURINI SANTOS">JUREMA SOLEDADE FURINI SANTOS</option>
<option value="KATIUSCIA ALVES BOMFIM">KATIUSCIA ALVES BOMFIM</option>
<option value="KETHY REGINA DA SILVA DOMINGOS COSTA">KETHY REGINA DA SILVA DOMINGOS COSTA</option>
<option value="LUANA CAROLINE ALVES LIMA">LUANA CAROLINE ALVES LIMA</option>
<option value="LUANA DE FREITAS SILVA">LUANA DE FREITAS SILVA</option>
<option value="LUCIANA NOVAIS CORREIA SANTOS">LUCIANA NOVAIS CORREIA SANTOS</option>
<option value="LUCIANO MOREIRA DE AZEVEDO">LUCIANO MOREIRA DE AZEVEDO</option>
<option value="MARCELO FERNANDES DA SILVA">MARCELO FERNANDES DA SILVA</option>
<option value="MARCIEL DA SILVA">MARCIEL DA SILVA</option>
<option value="MARIA HELENA CUNHA MORO">MARIA HELENA CUNHA MORO</option>
<option value="MARIA QUITÉRIA FERREIRA DOS SANTOS">MARIA QUITÉRIA FERREIRA DOS SANTOS</option>
<option value="MARINA DA CONCEICAO FRANCISCO SILVA">MARINA DA CONCEICAO FRANCISCO SILVA</option>
<option value="MAURICIO DE BARROS SANTOS">MAURICIO DE BARROS SANTOS</option>
<option value="MICHELE DE PINHO MORAES">MICHELE DE PINHO MORAES</option>
<option value="MOISES ANTONIO DE BARROS">MOISES ANTONIO DE BARROS</option>
<option value="PATRICIA GOMES ROCHA RIBEIRO">PATRICIA GOMES ROCHA RIBEIRO</option>
<option value="PAULA ARMANI VILA">PAULA ARMANI VILA</option>
<option value="PAULO ROBERTO DA SILVA ITO">PAULO ROBERTO DA SILVA ITO</option>
<option value="PEDRO ZANOTTI FILHO">PEDRO ZANOTTI FILHO</option>
<option value="RAUL PEREIRA VILERA JUNIOR">RAUL PEREIRA VILERA JUNIOR</option>
<option value="REGIANE CURTI DE SOUZA OLIVEIRA">REGIANE CURTI DE SOUZA OLIVEIRA</option>
<option value="REGINA DA SILVA CASTRO">REGINA DA SILVA CASTRO</option>
<option value="RICARDO AMERICO DA SILVA">RICARDO AMERICO DA SILVA</option>
<option value="ROBERTO SALGADO">ROBERTO SALGADO</option>
<option value="RODRIGO VIEIRA">RODRIGO VIEIRA</option>
<option value="ROSANGELA CAFASSO MOREIRA">ROSANGELA CAFASSO MOREIRA</option>
<option value="ROSIMERY DE SOUZA PESSOA">ROSIMERY DE SOUZA PESSOA</option>
<option value="ROSMARA DA SILVA CARDOSO">ROSMARA DA SILVA CARDOSO</option>
<option value="SANDRA CRISTINA MACEDO MORAES">SANDRA CRISTINA MACEDO MORAES</option>
<option value="SELMA GOMES DA SILVA">SELMA GOMES DA SILVA</option>
<option value="SERGIO AGRIPINO VILLA NOVA">SERGIO AGRIPINO VILLA NOVA</option>
<option value="SOLANGE ALMEIDA DA SILVA">SOLANGE ALMEIDA DA SILVA</option>
<option value="SUELI SILVE PEREIRA">SUELI SILVE PEREIRA</option>
<option value="SUZINEIDE SILVA DE FREITAS">SUZINEIDE SILVA DE FREITAS</option>
<option value="THIAGO FABIANO BRITO">THIAGO FABIANO BRITO</option>
<option value="TITTO AUGUSTO NASCIMENTO SILVA">TITTO AUGUSTO NASCIMENTO SILVA</option>
<option value="VANDERSON HYPPOLITO">VANDERSON HYPPOLITO</option>
<option value="VANESSA IVETE GOMES DOS SANTOS">VANESSA IVETE GOMES DOS SANTOS</option>
<option value="VANIA PENHA DE BARROS">VANIA PENHA DE BARROS</option>
<option value="VIVIANE LEAL CAMERA DE MORAES">VIVIANE LEAL CAMERA DE MORAES</option>
<option value="WILSON LUIZ DE SOUZA COSTA">WILSON LUIZ DE SOUZA COSTA</option>
<option value="WILSON RODRIGUES MOTA">WILSON RODRIGUES MOTA</option>
          </select>
        </div>
        <div class="form-group">
          <label>EMAIL:</label>
          <input type="email" id="email-professor" readonly>
        </div>
      </div>

      <div class="form-row">
        <div class="form-group">
          <label>APARELHO:</label>
          <select id="aparelho" onchange="atualizarMarca()">
            <option value="">Selecione</option>
            <option value="TABLET">TABLET</option>
            <option value="SMARTPHONE">SMARTPHONE</option>
            <option value="CHROMEBOOK">CHROMEBOOK</option>
            <option value="NOTEBOOK">NOTEBOOK</option>
            <option value="PROJETOR">PROJETOR</option>
            <option value="CAIXA DE SOM">CAIXA DE SOM</option>
            <option value="MICROFONE">MICROFONE</option>
            <option value="WEBCAM">WEBCAM</option>
            <option value="ROTEADOR">ROTEADOR</option>
            <option value="IMPRESSORA">IMPRESSORA</option>
          </select>
        </div>

        <div class="form-group">
          <label>MARCA:</label>
          <input type="text" id="marca" readonly>
        </div>
      </div>

      <div class="form-row">
        <div class="form-group">
          <label>N° DE APARELHOS:</label>
          <input type="number" id="numero-aparelhos" min="1" value="1">
        </div>
        
        <div class="form-group datepicker-container">
          <label>DATA:</label>
          <input type="text" id="data-selecionada" class="datepicker-input" readonly placeholder="Clique para selecionar">
          <div class="datepicker-popup" id="datepickerPopup">
            <div class="datepicker-header">
              <button class="datepicker-nav" id="prevMonth">&lt;</button>
              <div class="datepicker-title" id="datepickerMonthYear"></div>
              <button class="datepicker-nav" id="nextMonth">&gt;</button>
            </div>
            <div class="datepicker-grid" id="datepickerWeekdays"></div>
            <div class="datepicker-grid" id="datepickerDays"></div>
          </div>
        </div>
      </div>

      <div class="form-row">
        <div class="form-group">
          <label>SELECIONE A TURMA:</label>
          <select id="studentClass" class="form-control" required onchange="atualizarSala()">
            <option value="">Selecione a turma</option>
            <option value="6° ANO A MANHA">6° ANO A MANHA</option>
            <option value="6° ANO B MANHA">6° ANO B MANHA</option>
            <option value="6° ANO C MANHA">6° ANO C MANHA</option>
            <option value="6° ANO D MANHA">6° ANO D MANHA</option>
            <option value="6° ANO E TARDE">6° ANO E TARDE</option>
            <option value="6° ANO F TARDE">6° ANO F TARDE</option>
            <option value="7° ANO A TARDE">7° ANO A TARDE</option>
            <option value="7° ANO B TARDE">7° ANO B TARDE</option>
            <option value="7° ANO C TARDE">7° ANO C TARDE</option>
            <option value="7° ANO D TARDE">7° ANO D TARDE</option>
            <option value="7° ANO E TARDE">7° ANO E TARDE</option>
            <option value="7° ANO F TARDE">7° ANO F TARDE</option>
            <option value="8° ANO A TARDE">8° ANO A TARDE</option>
            <option value="8° ANO B TARDE">8° ANO B TARDE</option>
            <option value="8° ANO C TARDE">8° ANO C TARDE</option>
            <option value="8° ANO D TARDE">8° ANO D TARDE</option>
            <option value="8° ANO E TARDE">8° ANO E TARDE</option>
            <option value="9° ANO A TARDE">9° ANO A TARDE</option>
            <option value="9° ANO B TARDE">9° ANO B TARDE</option>
            <option value="9° ANO C TARDE">9° ANO C TARDE</option>
            <option value="9° ANO D TARDE">9° ANO D TARDE</option>
            <option value="1ª SERIE A MANHA">1ª SERIE A MANHA</option>
            <option value="1ª SERIE B MANHA">1ª SERIE B MANHA</option>
            <option value="1ª SERIE C MANHA">1ª SERIE C MANHA</option>
            <option value="1ª SERIE D MANHA">1ª SERIE D MANHA</option>
            <option value="1ª SERIE E MANHA">1ª SERIE E MANHA</option>
            <option value="1ª SERIE F MANHA">1ª SERIE F MANHA</option>
            <option value="1ª SERIE G TARDE">1ª SERIE G TARDE</option>
            <option value="1ª SERIE H NOITE">1ª SERIE H NOITE</option>
            <option value="1ª SERIE I NOITE">1ª SERIE I NOITE</option>
            <option value="2ª SERIE A MANHA">2ª SERIE A MANHA</option>
            <option value="2ª SERIE B MANHA">2ª SERIE B MANHA</option>
            <option value="2ª SERIE C MANHA">2ª SERIE C MANHA</option>
            <option value="2ª SERIE D MANha">2ª SERIE D MANha</option>
            <option value="2ª SERIE E MANHA">2ª SERIE E MANHA</option>
            <option value="2ª SERIE F NOITE">2ª SERIE F NOITE</option>
            <option value="2ª SERIE G NOITE">2ª SERIE G NOITE</option>
            <option value="2ª SERIE H NOITE">2ª SERIE H NOITE</option>
            <option value="2ª SERIE I NOITE">2ª SERIE I NOITE</option>
            <option value="3ª SERIE A MANHA">3ª SERIE A MANHA</option>
            <option value="3ª SERIE B MANHA">3ª SERIE B MANHA</option>
            <option value="3ª SERIE C MANHA">3ª SERIE C MANHA</option>
            <option value="3ª SERIE D NOITE">3ª SERIE D NOITE</option>
            <option value="3ª SERIE E NOITE">3ª SERIE E NOITE</option>
            <option value="3ª SERIE F NOITE">3ª SERIE F NOITE</option>
            <option value="3ª SERIE G NOITE">3ª SERIE G NOITE</option>
            <option value="4050 - ADMINISTRAÇÃO - 2ª SERIE A MANHA">4050 - ADMINISTRAÇÃO - 2ª SERIE A MANHA</option>
          </select>
        </div>

        <div class="form-group">
          <label>SALA:</label>
          <input type="text" id="sala" readonly>
        </div>
      </div>

      <div class="form-row">
        <div class="form-group" onclick="abrirRelogio('hora-retirada')" style="cursor: pointer;">
          <label for="hora-retirada">RETIRADA:</label>
          <input type="time" id="hora-retirada" required>
        </div>
        <div class="form-group" onclick="abrirRelogio('hora-entrega')" style="cursor: pointer;">
          <label for="hora-entrega">ENTREGA:</label>
          <input type="time" id="hora-entrega">
        </div>
      </div>

      <div class="form-group">
        <label for="aula">Aula:</label>
        <select id="aula">
          <option>1ª Aula</option>
          <option>2ª Aula</option>
          <option>3ª Aula</option>
          <option>4ª Aula</option>
          <option>5ª Aula</option>
          <option>6ª Aula</option>
          <option>7ª Aula</option>
          <option>8ª Aula</option>
          <option>9ª Aula</option>
          <option>10ª Aula</option>
        </select>
      </div>

      <div class="conflict-message" id="conflictMessage">
        Já existe um agendamento para esta turma nesta data e aula!
      </div>

      <div class="buttons-container">
        <button class="btn btn-cadastrar" onclick="cadastrarAgendamento()">CADASTRAR</button>
        <button class="btn btn-limpar" onclick="limparFormulario()">LIMPAR</button>
      </div>
    </div>

    <div class="calendar-container">
      <div class="export-buttons">
        <button class="btn btn-cadastrar" onclick="exportarParaPDF()">Exportar para PDF</button>
        <button class="btn btn-cadastrar" onclick="exportarParaCSV()">Exportar para CSV</button>
      </div>
      
      <div style="margin-bottom: 20px;">
        <select id="monthSelect"></select>
        <select id="yearSelect"></select>
      </div>

      <table class="calendar">
        <thead>
          <tr>
            <th>Dom</th>
            <th>Seg</th>
            <th>Ter</th>
            <th>Qua</th>
            <th>Qui</th>
            <th>Sex</th>
            <th>Sáb</th>
          </tr>
        </thead>
        <tbody id="calendarBody">
          <!-- Dias serão inseridos via JavaScript -->
        </tbody>
      </table>

      <h3>HISTÓRICO DE AGENDAMENTOS</h3>
      <table class="historico-table">
        <thead>
          <tr>
            <th>DATA</th>
            <th>TURMA</th>
            <th>N° APARELHOS</th>
            <th>APARELHO</th>
            <th>PROFESSOR</th>
            <th>AULA(s)</th>
            <th>ENTREGA</th>
            <th>AÇÃO</th>
          </tr>
        </thead>
        <tbody id="historico-body">
          <!-- Histórico dinâmico -->
        </tbody>
      </table>
    </div>
  </div>

  <!-- Modal para confirmação de devolução -->
  <div id="devolucaoModal" class="modal">
    <div class="modal-content">
      <span class="close" onclick="fecharModal()">&times;</span>
      <h3>Registrar Devolução</h3>
      <p id="modalText"></p>
      <div class="form-group">
        <label for="horaEntregaModal">Hora da Entrega:</label>
        <input type="time" id="horaEntregaModal" value="">
      </div>
      <div class="modal-buttons">
        <button class="btn btn-limpar" onclick="fecharModal()">Cancelar</button>
        <button class="btn btn-entregar" onclick="confirmarDevolucao()">Confirmar</button>
      </div>
    </div>
  </div>

  <script>
    // Inicializa o jsPDF
    const { jsPDF } = window.jspdf;
    
    // Dados dos professores
    const teacherEmails = {
{
  "ADEMAR RIBEIRO DE SOUZA": "ademarribeirosouza@prof.educacao.sp.gov.br",
  "ALEX LUTH PEREIRA MARANHAO": "luth@prof.educacao.sp.gov.br",
  "ALEXANDRE SILVA LIMA": "alexandresilvalima@prof.educacao.sp.gov.br",
  "ALEXSANDRA PAULA VARELLA DE SOUZA": "avarella@prof.educacao.sp.gov.br",
  "ALISON VASCONCELOS BESERRA": "alisonv@prof.educacao.sp.gov.br",
  "AMAURI TEODORO DE OLIVEIRA": "amaurit@prof.educacao.sp.gov.br",
  "ANA PAULA DOS SANTOS": "paulasantosa@prof.educacao.sp.gov.br",
  "ANDRE LUIZ TAVARES": "andreltavares@prof.educacao.sp.gov.br",
  "ANDREIA DOS SANTOS FREITAS": "sanfreitas@prof.educacao.sp.gov.br",
  "ANDREIA MADUREIRA REIS": "andreiamadureira@prof.educacao.sp.gov.br",
  "ANTONIO CARLOS DE OLIVEIRA": "antoniocarloso@prof.educacao.sp.gov.br",
  "ANTONIO RAMOS DE ARAUJO": "antonioramosaraujo@prof.educacao.sp.gov.br",
  "ANTONIO WILTON WANDERLEY CABRAL": "antoniowilton@prof.educacao.sp.gov.br",
  "AUGUSTO LINO PESSOA NETO": "augustolino@prof.educacao.sp.gov.br",
  "AUREA MARIA DE JESUS MARQUES": "aureamaria@prof.educacao.sp.gov.br",
  "CAROLINA PERNOMIAN PARUSSOLO": "carolinapernomian@prof.educacao.sp.gov.br",
  "CASSIA OLIVEIRA ANTONIAZI": "cassiaosilva@prof.educacao.sp.gov.br",
  "DANIEL DE FREITAS ALMEIDA": "danielalmeida@prof.educacao.sp.gov.br",
  "DANIEL LOPES BARBOSA": "daniellopesbarbosa@prof.educacao.sp.gov.br",
  "DANIELA FERREIRA LIMA": "danielaflima@prof.educacao.sp.gov.br",
  "EDIANE VIEIRA DA SILVA": "ediane@prof.educacao.sp.gov.br",
  "EDILEUSA NUNES PEREIRA": "edileusa@prof.educacao.sp.gov.br",
  "EDUARDO HENRIQUE DA FONSECA": "henriquefonseca@prof.educacao.sp.gov.br",
  "ELIANE SANTOS SILVA": "essantos@prof.educacao.sp.gov.br",
  "ELIAS MONTEIRO DA SILVA": "elias1@prof.educacao.sp.gov.br",
  "ELISABETE APARECIDA PIRES": "elisabetepires@prof.educacao.sp.gov.br",
  "ELZA DE FARIA PEREIRA": "elzafariapereira@prof.educacao.sp.gov.br",
  "EMERSON GABLER DE ALMEIDA": "egabler@prof.educacao.sp.gov.br",
  "ERINEIDE LEITE ARAGAO NERY": "erineidearagao@prof.educacao.sp.gov.br",
  "EUZELI ARAUJO DE OLIVEIRA": "euzeli@prof.educacao.sp.gov.br",
  "FABIANO AUGUSTO PIEDADE": "fabianoaugusto@prof.educacao.sp.gov.br",
  "FABIO CAMILO": "camilof@prof.educacao.sp.gov.br",
  "FERNANDO JOSE DA SILVA FILHO": "fernandojs@prof.educacao.sp.gov.br",
  "FLAVIA CRISTINA APARECIDA BICHLER": "flaviacri@prof.educacao.sp.gov.br",
  "FLÁVIA CRISTINA APARECIDA BICHLER": "flaviacri@prof.educacao.sp.gov.br",
  "FLAVIO CARDOSO FLEURY": "flaviofleury@prof.educacao.sp.gov.br",
  "GABRIELA SERIGHELLI DE MELO": "gabrielaserighelli@prof.educacao.sp.gov.br",
  "GENILTON DE OLIVEIRA SILVA": "genilton@prof.educacao.sp.gov.br",
  "GIANI CRISTINA DO PRADO": "gianiprado@prof.educacao.sp.gov.br",
  "INGRYD CAROLINA SUGUIMOTO VIEIRA": "ingryd@prof.educacao.sp.gov.br",
  "IVANILDES DOS SANTOS OSHIKAWA": "oshikawa@prof.educacao.sp.gov.br",
  "JANINA DOS PASSOS BRAGA DE ALMEIDA": "janinabraga@prof.educacao.sp.gov.br",
  "JUAREZ GOMES DE MAGALHAES FILHO": "juarezgomes@prof.educacao.sp.gov.br",
  "JUREMA SOLEDADE FURINI SANTOS": "juremas@prof.educacao.sp.gov.br",
  "KATIUSCIA ALVES BOMFIM": "katiusciabomfim@prof.educacao.sp.gov.br",
  "KETHY REGINA DA SILVA DOMINGOS COSTA": "kethy@prof.educacao.sp.gov.br",
  "LUANA CAROLINE ALVES LIMA": "luanalima01@prof.educacao.sp.gov.br",
  "LUANA DE FREITAS SILVA": "luanafreitas@prof.educacao.sp.gov.br",
  "LUCIANA NOVAIS CORREIA SANTOS": "novaiscorreia@prof.educacao.sp.gov.br",
  "LUCIANO MOREIRA DE AZEVEDO": "lucianomoreira@prof.educacao.sp.gov.br",
  "MARCELO FERNANDES DA SILVA": "marcelofs@prof.educacao.sp.gov.br",
  "MARCIEL DA SILVA": "marcielsilva@prof.educacao.sp.gov.br",
  "MARIA HELENA CUNHA MORO": "marcunha@prof.educacao.sp.gov.br",
  "MARIA QUITÉRIA FERREIRA DOS SANTOS": "quiteriasantos@prof.educacao.sp.gov.br",
  "MARINA DA CONCEICAO FRANCISCO SILVA": "marinafrancisco@prof.educacao.sp.gov.br",
  "MAURICIO DE BARROS SANTOS": "mauriciobsantos@prof.educacao.sp.gov.br",
  "MICHELE DE PINHO MORAES": "michelepinho@prof.educacao.sp.gov.br",
  "MOISES ANTONIO DE BARROS": "moisesbarros@prof.educacao.sp.gov.br",
  "PATRICIA GOMES ROCHA RIBEIRO": "patriciag@prof.educacao.sp.gov.br",
  "PAULA ARMANI VILA": "paulaarmani@prof.educacao.sp.gov.br",
  "PAULO ROBERTO DA SILVA ITO": "pauloito@prof.educacao.sp.gov.br",
  "PEDRO ZANOTTI FILHO": "pedrozanotti@prof.educacao.sp.gov.br",
  "RAUL PEREIRA VILERA JUNIOR": "vilera@prof.educacao.sp.gov.br",
  "REGIANE CURTI DE SOUZA OLIVEIRA": "regianecurti@prof.educacao.sp.gov.br",
  "REGINA DA SILVA CASTRO": "reginasilvacastro@prof.educacao.sp.gov.br",
  "RICARDO AMERICO DA SILVA": "ricardoamerico@prof.educacao.sp.gov.br",
  "ROBERTO SALGADO": "robertosalgado@prof.educacao.sp.gov.br",
  "RODRIGO VIEIRA": "rodrigovieira1@prof.educacao.sp.gov.br",
  "ROSANGELA CAFASSO MOREIRA": "cafasso@prof.educacao.sp.gov.br",
  "ROSIMERY DE SOUZA PESSOA": "rosimerypessoa@prof.educacao.sp.gov.br",
  "ROSMARA DA SILVA CARDOSO": "rosmaracardoso@prof.educacao.sp.gov.br",
  "SANDRA CRISTINA MACEDO MORAES": "sandracristinamacedo@prof.educacao.sp.gov.br",
  "SELMA GOMES DA SILVA": "selmagomess@prof.educacao.sp.gov.br",
  "SERGIO AGRIPINO VILLA NOVA": "sergioagripino@prof.educacao.sp.gov.br",
  "SOLANGE ALMEIDA DA SILVA": "almeidafazio@prof.educacao.sp.gov.br",
  "SUELI SILVE PEREIRA": "suelisilve@prof.educacao.sp.gov.br",
  "SUZINEIDE SILVA DE FREITAS": "suzineidefreitas@prof.educacao.sp.gov.br",
  "THIAGO FABIANO BRITO": "thiagofabiano@prof.educacao.sp.gov.br",
  "TITTO AUGUSTO NASCIMENTO SILVA": "titto@prof.educacao.sp.gov.br",
  "VANDERSON HYPPOLITO": "vhypolito@prof.educacao.sp.gov.br",
  "VANESSA IVETE GOMES DOS SANTOS": "vanessaivete@prof.educacao.sp.gov.br",
  "VANIA PENHA DE BARROS": "vaniapenha@prof.educacao.sp.gov.br",
  "VIVIANE LEAL CAMERA DE MORAES": "camera@prof.educacao.sp.gov.br",
  "WILSON LUIZ DE SOUZA COSTA": "wilsonluizsouza@prof.educacao.sp.gov.br",
  "WILSON RODRIGUES MOTA": "wmota@prof.educacao.sp.gov.br"
}
    };

    // Dados das salas por turma
    const turmasSalas = {
      "6° ANO A MANHA": "Sala 1",
      "6° ANO B MANHA": "Sala 2",
      "6° ANO C MANHA": "Sala 3",
      "6° ANO D MANHA": "Sala 4",
      "6° ANO E TARDE": "Sala 1",
      "6° ANO F TARDE": "Sala 2",
      "7° ANO A TARDE": "Sala 3",
      "7° ANO B TARDE": "Sala 4",
      "7° ANO C TARDE": "Sala 5",
      "7° ANO D TARDE": "Sala 6",
      "7° ANO E TARDE": "Sala 7",
      "7° ANO F TARDE": "Sala 8",
      "8° ANO A TARDE": "Sala 10",
      "8° ANO B TARDE": "Sala 11",
      "8° ANO C TARDE": "Sala 12",
      "8° ANO D TARDE": "Sala 13",
      "8° ANO E TARDE": "Sala 14",
      "9° ANO A TARDE": "Sala 15",
      "9° ANO B TARDE": "Sala 16",
      "9° ANO C TARDE": "Sala 17",
      "9° ANO D TARDE": "Sala 18",
      "1ª SERIE A MANHA": "Sala 10",
      "1ª SERIE B MANHA": "Sala 11",
      "1ª SERIE C MANHA": "Sala 12",
      "1ª SERIE D MANHA": "Sala 13",
      "1ª SERIE E MANHA": "Sala 14",
      "1ª SERIE F MANHA": "Sala 15",
      "1ª SERIE G TARDE": "Sala 9",
      "1ª SERIE H NOITE": "Sala 9",
      "1ª SERIE I NOITE": "Sala 10",
      "2ª SERIE A MANHA": "Sala 5",
      "2ª SERIE B MANHA": "Sala 6",
      "2ª SERIE C MANHA": "Sala 7",
      "2ª SERIE D MANHA": "Sala 8",
      "2ª SERIE E MANHA": "Sala 9",
      "2ª SERIE F NOITE": "Sala 1",
      "2ª SERIE G NOITE": "Sala 2",
      "2ª SERIE H NOITE": "Sala 3",
      "2ª SERIE I NOITE": "Sala 4",
      "3ª SERIE A MANHA": "Sala 16",
      "3ª SERIE B MANHA": "Sala 17",
      "3ª SERIE C MANHA": "Sala 18",
      "3ª SERIE D NOITE": "Sala 5",
      "3ª SERIE E NOITE": "Sala 6",
      "3ª SERIE F NOITE": "Sala 7",
      "3ª SERIE G NOITE": "Sala 8",
      "4050 - ADMINISTRAÇÃO - 2ª SERIE A MANHA": "Laboratório 1"
    };

    // Dados das marcas por tipo de aparelho
    const aparelhosMarcas = {
      "TABLET": "Samsung Galaxy Tab A",
      "SMARTPHONE": "Motorola Moto G",
      "CHROMEBOOK": "Acer Chromebook 314",
      "NOTEBOOK": "Dell Inspiron 15",
      "PROJETOR": "Epson EB-X41",
      "CAIXA DE SOM": "JBL Flip 5",
      "MICROFONE": "HyperX QuadCast",
      "WEBCAM": "Logitech C920",
      "ROTEADOR": "TP-Link Archer C6",
      "IMPRESSORA": "HP LaserJet Pro"
    };

    // Variáveis globais
    let agendamentos = [];
    let currentDate = new Date();
    let selectedDate = null;
    let currentAgendamentoId = null;

    // Inicialização do sistema
    document.addEventListener('DOMContentLoaded', function() {
      inicializarCalendario();
      carregarAgendamentos();
      carregarMesesAnos();
      atualizarSala(); // Atualiza sala baseada na turma selecionada
    });

    // Função para atualizar email do professor
    function atualizarEmail() {
      const professorSelecionado = document.getElementById('professor').value;
      const emailProfessor = document.getElementById('email-professor');
      
      if (professorSelecionado && professorSelecionado !== 'Selecione') {
        emailProfessor.value = teacherEmails[professorSelecionado] || '';
      } else {
        emailProfessor.value = '';
      }
    }

    // Função para atualizar marca do aparelho
    function atualizarMarca() {
      const aparelhoSelecionado = document.getElementById('aparelho').value;
      const marcaInput = document.getElementById('marca');
      
      if (aparelhoSelecionado) {
        marcaInput.value = aparelhosMarcas[aparelhoSelecionado] || '';
      } else {
        marcaInput.value = '';
      }
      
      // Verificar disponibilidade ao mudar o aparelho
      verificarDisponibilidade();
    }

    // Função para atualizar sala baseada na turma selecionada
    function atualizarSala() {
      const turmaSelecionada = document.getElementById('studentClass').value;
      const salaInput = document.getElementById('sala');
      
      if (turmaSelecionada) {
        salaInput.value = turmasSalas[turmaSelecionada] || '';
      } else {
        salaInput.value = '';
      }
    }

    // Função para abrir o relógio (time picker)
    function abrirRelogio(id) {
      document.getElementById(id).showPicker();
    }

    // Função para inicializar o calendário
    function inicializarCalendario() {
      const datepickerInput = document.getElementById('data-selecionada');
      const datepickerPopup = document.getElementById('datepickerPopup');
      const prevMonthBtn = document.getElementById('prevMonth');
      const nextMonthBtn = document.getElementById('nextMonth');
      const datepickerMonthYear = document.getElementById('datepickerMonthYear');
      const datepickerWeekdays = document.getElementById('datepickerWeekdays');
      const datepickerDays = document.getElementById('datepickerDays');

      // Dias da semana
      const weekdays = ['Dom', 'Seg', 'Ter', 'Qua', 'Qui', 'Sex', 'Sáb'];
      datepickerWeekdays.innerHTML = weekdays.map(day => `<div class="datepicker-weekday">${day}</div>`).join('');

      // Atualizar calendário
      function updateCalendar() {
        const year = currentDate.getFullYear();
        const month = currentDate.getMonth();

        datepickerMonthYear.textContent = `${new Date(year, month).toLocaleDateString('pt-BR', { month: 'long', year: 'numeric' })}`.toUpperCase();

        const firstDay = new Date(year, month, 1);
        const lastDay = new Date(year, month + 1, 0);
        const daysInMonth = lastDay.getDate();
        const firstDayIndex = firstDay.getDay();

        let days = '';

        // Dias do mês anterior
        const prevLastDay = new Date(year, month, 0).getDate();
        for (let i = firstDayIndex; i > 0; i--) {
          days += `<div class="datepicker-day datepicker-other-month" data-day="${prevLastDay - i + 1}" data-month="${month - 1}" data-year="${year}">${prevLastDay - i + 1}</div>`;
        }

        // Dias do mês atual
        const today = new Date();
        for (let i = 1; i <= daysInMonth; i++) {
          const dayDate = new Date(year, month, i);
          const isToday = dayDate.toDateString() === today.toDateString();
          const isSelected = selectedDate && dayDate.toDateString() === selectedDate.toDateString();
          
          let dayClass = 'datepicker-day';
          if (isToday) dayClass += ' datepicker-today';
          if (isSelected) dayClass += ' selected';
          
          days += `<div class="${dayClass}" data-day="${i}" data-month="${month}" data-year="${year}">${i}</div>`;
        }

        // Dias do próximo mês
        const daysToShow = 42 - (firstDayIndex + daysInMonth);
        for (let i = 1; i <= daysToShow; i++) {
          days += `<div class="datepicker-day datepicker-other-month" data-day="${i}" data-month="${month + 1}" data-year="${year}">${i}</div>`;
        }

        datepickerDays.innerHTML = days;
      }

      // Mostrar/ocultar calendário
      datepickerInput.addEventListener('click', function(e) {
        e.stopPropagation();
        datepickerPopup.classList.toggle('active');
        updateCalendar();
      });

      // Selecionar data
      datepickerDays.addEventListener('click', function(e) {
        if (e.target.classList.contains('datepicker-day') && !e.target.classList.contains('datepicker-other-month')) {
          const day = parseInt(e.target.getAttribute('data-day'));
          const month = parseInt(e.target.getAttribute('data-month'));
          const year = parseInt(e.target.getAttribute('data-year'));
          
          selectedDate = new Date(year, month, day);
          datepickerInput.value = selectedDate.toLocaleDateString('pt-BR');
          datepickerPopup.classList.remove('active');
          
          // Atualizar calendário principal
          updateMainCalendar();
          // Verificar disponibilidade ao selecionar data
          verificarDisponibilidade();
        }
      });

      // Navegar entre meses
      prevMonthBtn.addEventListener('click', function() {
        currentDate.setMonth(currentDate.getMonth() - 1);
        updateCalendar();
      });

      nextMonthBtn.addEventListener('click', function() {
        currentDate.setMonth(currentDate.getMonth() + 1);
        updateCalendar();
      });

      // Fechar calendário ao clicar fora
      document.addEventListener('click', function() {
        datepickerPopup.classList.remove('active');
      });

      datepickerPopup.addEventListener('click', function(e) {
        e.stopPropagation();
      });

      updateCalendar();
    }

    // Função para atualizar o calendário principal
    function updateMainCalendar() {
      const calendarBody = document.getElementById('calendarBody');
      const monthSelect = document.getElementById('monthSelect');
      const yearSelect = document.getElementById('yearSelect');
      
      const month = monthSelect.value ? parseInt(monthSelect.value) : currentDate.getMonth();
      const year = yearSelect.value ? parseInt(yearSelect.value) : currentDate.getFullYear();
      
      const firstDay = new Date(year, month, 1);
      const lastDay = new Date(year, month + 1, 0);
      const daysInMonth = lastDay.getDate();
      const firstDayIndex = firstDay.getDay();
      
      let date = 1;
      let html = '';
      
      for (let i = 0; i < 6; i++) {
        html += '<tr>';
        
        for (let j = 0; j < 7; j++) {
          if (i === 0 && j < firstDayIndex) {
            html += '<td></td>';
          } else if (date > daysInMonth) {
            html += '<td></td>';
          } else {
            const currentDate = new Date(year, month, date);
            const dateString = currentDate.toISOString().split('T')[0];
            
            // Verificar se há agendamentos para esta data
            const agendamentosDia = agendamentos.filter(a => a.data === dateString);
            
            let cellClass = '';
            if (agendamentosDia.length > 0) {
              cellClass = 'agendado';
            } else if (currentDate < new Date(new Date().setHours(0, 0, 0, 0))) {
              cellClass = 'indisponivel';
            } else {
              cellClass = 'disponivel';
            }
            
            if (selectedDate && currentDate.toDateString() === selectedDate.toDateString()) {
              cellClass = 'selecionado';
            }
            
            html += `<td class="${cellClass}" data-date="${dateString}">${date}</td>`;
            date++;
          }
        }
        
        html += '</tr>';
        
        if (date > daysInMonth) {
          break;
        }
      }
      
      calendarBody.innerHTML = html;
      
      // Adicionar eventos de clique às células do calendário
      document.querySelectorAll('#calendarBody td').forEach(cell => {
        if (!cell.classList.contains('indisponivel')) {
          cell.addEventListener('click', function() {
            const dateString = this.getAttribute('data-date');
            if (dateString) {
              selectedDate = new Date(dateString);
              document.getElementById('data-selecionada').value = selectedDate.toLocaleDateString('pt-BR');
              
              // Atualizar calendário para mostrar a data selecionada
              updateMainCalendar();
              // Verificar disponibilidade ao selecionar data
              verificarDisponibilidade();
            }
          });
        }
      });
    }

    // Função para carregar meses e anos nos selects
    function carregarMesesAnos() {
      const monthSelect = document.getElementById('monthSelect');
      const yearSelect = document.getElementById('yearSelect');
      
      // Meses
      const months = [
        'Janeiro', 'Fevereiro', 'Março', 'Abril', 'Maio', 'Junho',
        'Julho', 'Agosto', 'Setembro', 'Outubro', 'Novembro', 'Dezembro'
      ];
      
      monthSelect.innerHTML = months.map((month, index) => 
        `<option value="${index}" ${index === currentDate.getMonth() ? 'selected' : ''}>${month}</option>`
      ).join('');
      
      // Anos (5 anos antes e depois do atual)
      const currentYear = currentDate.getFullYear();
      yearSelect.innerHTML = '';
      
      for (let year = currentYear - 5; year <= currentYear + 5; year++) {
        const option = document.createElement('option');
        option.value = year;
        option.textContent = year;
        if (year === currentYear) option.selected = true;
        yearSelect.appendChild(option);
      }
      
      // Atualizar calendário quando mês/ano mudar
      monthSelect.addEventListener('change', updateMainCalendar);
      yearSelect.addEventListener('change', updateMainCalendar);
    }

    // Função para carregar agendamentos (simulação)
    function carregarAgendamentos() {
      // Em um sistema real, isso viria de uma API ou banco de dados
      agendamentos = [
        {
          id: 1,
          professor: "ADEMAR RIBEIRO DE SOUZA",
          email: "ademarribeirosouza@prof.educacao.sp.gov.br",
          aparelho: "TABLET",
          marca: "Samsung Galaxy Tab A",
          quantidade: 5,
          data: new Date(new Date().setDate(new Date().getDate() + 1)).toISOString().split('T')[0],
          turma: "6° ANO A MANHA",
          sala: "Sala 101",
          horaRetirada: "08:00",
          horaEntrega: "10:00",
          aula: "1ª Aula",
          status: "pendente"
        },
        {
          id: 2,
          professor: "ALEX LUTH PEREIRA MARANHAO",
          email: "luth@prof.educacao.sp.gov.br",
          aparelho: "NOTEBOOK",
          marca: "Dell Inspiron 15",
          quantidade: 3,
          data: new Date(new Date().setDate(new Date().getDate() + 2)).toISOString().split('T')[0],
          turma: "7° ANO B TARDE",
          sala: "Sala 202",
          horaRetirada: "14:00",
          horaEntrega: "16:00",
          aula: "3ª Aula",
          status: "entregue"
        },
        {
          id: 3,
          professor: "ALEXANDRE SILVA LIMA",
          email: "alexandresilvalima@prof.educacao.sp.gov.br",
          aparelho: "PROJETOR",
          marca: "Epson EB-X41",
          quantidade: 1,
          data: new Date(new Date().setDate(new Date().getDate() - 1)).toISOString().split('T')[0],
          turma: "9° ANO B TARDE",
          sala: "Sala 402",
          horaRetirada: "10:00",
          horaEntrega: "12:00",
          aula: "2ª Aula",
          status: "entregue"
        }
      ];
      
      atualizarHistorico();
      updateMainCalendar();
    }

    // Função para atualizar o histórico de agendamentos
    function atualizarHistorico() {
      const historicoBody = document.getElementById('historico-body');
      historicoBody.innerHTML = '';
      
      // Ordenar agendamentos por data (mais recentes primeiro)
      agendamentos.sort((a, b) => new Date(b.data) - new Date(a.data));
      
      agendamentos.forEach(agendamento => {
        const row = document.createElement('tr');
        if (agendamento.status === 'entregue') row.classList.add('entregue');
        if (agendamento.status === 'excluido') row.classList.add('excluido');
        
        const dataFormatada = new Date(agendamento.data).toLocaleDateString('pt-BR');
        
        row.innerHTML = `
          <td>${dataFormatada}</td>
          <td>${agendamento.turma}</td>
          <td>${agendamento.quantidade}</td>
          <td>${agendamento.aparelho} (${agendamento.marca})</td>
          <td>${agendamento.professor}</td>
          <td>${agendamento.aula}</td>
          <td>${agendamento.horaEntrega || '--:--'}</td>
          <td>
            ${agendamento.status !== 'entregue' && agendamento.status !== 'excluido' ? 
              `<button class="btn btn-entregar" onclick="abrirModalDevolucao(${agendamento.id})">Entregar</button>` : 
              ''}
            ${agendamento.status !== 'excluido' ? 
              `<button class="btn btn-excluir" onclick="excluirAgendamento(${agendamento.id})">${agendamento.status === 'excluido' ? 'Excluído' : 'Excluir'}</button>` : 
              ''}
          </td>
        `;
        
        historicoBody.appendChild(row);
      });
    }

    // Função para abrir modal de devolução
    function abrirModalDevolucao(id) {
      const agendamento = agendamentos.find(a => a.id === id);
      if (agendamento) {
        currentAgendamentoId = id;
        document.getElementById('modalText').textContent = 
          `Confirmar devolução de ${agendamento.quantidade} ${agendamento.aparelho}(s) para ${agendamento.professor}?`;
        document.getElementById('horaEntregaModal').value = '';
        document.getElementById('devolucaoModal').style.display = 'block';
      }
    }

    // Função para fechar modal
    function fecharModal() {
      document.getElementById('devolucaoModal').style.display = 'none';
      currentAgendamentoId = null;
    }

    // Função para confirmar devolução
    function confirmarDevolucao() {
      const horaEntrega = document.getElementById('horaEntregaModal').value;
      
      if (!horaEntrega) {
        alert('Por favor, informe a hora da entrega.');
        return;
      }
      
      const index = agendamentos.findIndex(a => a.id === currentAgendamentoId);
      if (index !== -1) {
        agendamentos[index].horaEntrega = horaEntrega;
        agendamentos[index].status = 'entregue';
        atualizarHistorico();
        updateMainCalendar();
        fecharModal();
        
        // Integração com sistema de cadastro - marcar equipamentos como disponíveis
        const agendamento = agendamentos[index];
        marcarEquipamentosDisponiveis(agendamento.aparelho, agendamento.quantidade, agendamento.data);
      }
    }

    // Função para excluir agendamento
    function excluirAgendamento(id) {
      if (confirm('Tem certeza que deseja excluir este agendamento?')) {
        const index = agendamentos.findIndex(a => a.id === id);
        if (index !== -1) {
          const agendamento = agendamentos[index];
          
          // Se não foi entregue, marcar equipamentos como disponíveis
          if (agendamento.status !== 'entregue') {
            marcarEquipamentosDisponiveis(agendamento.aparelho, agendamento.quantidade, agendamento.data);
          }
          
          agendamentos[index].status = 'excluido';
          atualizarHistorico();
          updateMainCalendar();
        }
      }
    }

    // Função para cadastrar novo agendamento
    function cadastrarAgendamento() {
      const professor = document.getElementById('professor').value;
      const email = document.getElementById('email-professor').value;
      const aparelho = document.getElementById('aparelho').value;
      const marca = document.getElementById('marca').value;
      const quantidade = parseInt(document.getElementById('numero-aparelhos').value);
      const data = document.getElementById('data-selecionada').value;
      const turma = document.getElementById('studentClass').value;
      const sala = document.getElementById('sala').value;
      const horaRetirada = document.getElementById('hora-retirada').value;
      const horaEntrega = document.getElementById('hora-entrega').value;
      const aula = document.getElementById('aula').value;
      
      // Validações
      if (professor === 'Selecione' || !professor) {
        alert('Por favor, selecione um professor.');
        return;
      }
      
      if (!aparelho) {
        alert('Por favor, selecione um aparelho.');
        return;
      }
      
      if (!quantidade || quantidade < 1) {
        alert('Por favor, informe um número válido de aparelhos.');
        return;
      }
      
      if (!data) {
        alert('Por favor, selecione uma data.');
        return;
      }
      
      if (!turma) {
        alert('Por favor, selecione uma turma.');
        return;
      }
      
      if (!horaRetirada) {
        alert('Por favor, informe a hora de retirada.');
        return;
      }
      
      // Verificar conflito de agendamento
      const dataISO = new Date(data.split('/').reverse().join('-')).toISOString().split('T')[0];
      const conflito = agendamentos.some(a => 
        a.data === dataISO && 
        a.turma === turma && 
        a.aula === aula && 
        a.status !== 'excluido'
      );
      
      if (conflito) {
        document.getElementById('conflictMessage').style.display = 'block';
        setTimeout(() => {
          document.getElementById('conflictMessage').style.display = 'none';
        }, 3000);
        return;
      }
      
      // Verificar disponibilidade de equipamentos
      if (!verificarDisponibilidadeNoCadastro(aparelho, quantidade, dataISO)) {
        alert(`Não há ${quantidade} ${aparelho}(s) disponível(eis) para a data selecionada.`);
        return;
      }
      
      // Criar novo agendamento
      const novoAgendamento = {
        id: agendamentos.length > 0 ? Math.max(...agendamentos.map(a => a.id)) + 1 : 1,
        professor,
        email,
        aparelho,
        marca,
        quantidade,
        data: dataISO,
        turma,
        sala,
        horaRetirada,
        horaEntrega,
        aula,
        status: 'pendente'
      };
      
      // Marcar equipamentos como indisponíveis no sistema de cadastro
      marcarEquipamentosIndisponiveis(aparelho, quantidade, dataISO);
      
      agendamentos.push(novoAgendamento);
      atualizarHistorico();
      updateMainCalendar();
      limparFormulario();
      
      alert('Agendamento cadastrado com sucesso!');
    }

    // Função para limpar formulário
    function limparFormulario() {
      document.getElementById('professor').value = 'Selecione';
      document.getElementById('email-professor').value = '';
      document.getElementById('aparelho').value = '';
      document.getElementById('marca').value = '';
      document.getElementById('numero-aparelhos').value = '1';
      document.getElementById('data-selecionada').value = '';
      document.getElementById('studentClass').value = '';
      document.getElementById('sala').value = '';
      document.getElementById('hora-retirada').value = '';
      document.getElementById('hora-entrega').value = '';
      document.getElementById('aula').value = '1ª Aula';
      selectedDate = null;
    }

    // Função para exportar para PDF
    function exportarParaPDF() {
      const doc = new jsPDF();
      
      // Título
      doc.setFontSize(18);
      doc.text('Histórico de Agendamentos', 105, 15, { align: 'center' });
      
      // Data de emissão
      doc.setFontSize(10);
      doc.text(`Emitido em: ${new Date().toLocaleDateString('pt-BR')}`, 105, 25, { align: 'center' });
      
      // Cabeçalho da tabela
      const headers = [
        'Data', 
        'Turma', 
        'N° Aparelhos', 
        'Aparelho', 
        'Professor', 
        'Aula', 
        'Entrega',
        'Status'
      ];
      
      // Dados da tabela
      const data = agendamentos.map(a => [
        new Date(a.data).toLocaleDateString('pt-BR'),
        a.turma,
        a.quantidade.toString(),
        `${a.aparelho} (${a.marca})`,
        a.professor,
        a.aula,
        a.horaEntrega || '--:--',
        a.status === 'entregue' ? 'Entregue' : 
        a.status === 'excluido' ? 'Excluído' : 'Pendente'
      ]);
      
      // Adicionar tabela
      doc.autoTable({
        head: [headers],
        body: data,
        startY: 30,
        styles: {
          fontSize: 8,
          cellPadding: 2,
          overflow: 'linebreak'
        },
        columnStyles: {
          0: { cellWidth: 20 },
          1: { cellWidth: 30 },
          2: { cellWidth: 15 },
          3: { cellWidth: 30 },
          4: { cellWidth: 40 },
          5: { cellWidth: 15 },
          6: { cellWidth: 15 },
          7: { cellWidth: 15 }
        }
      });
      
      // Salvar PDF
      doc.save('historico_agendamentos.pdf');
    }

    // Função para exportar para CSV
    function exportarParaCSV() {
      const headers = [
        'Data', 
        'Turma', 
        'N° Aparelhos', 
        'Aparelho', 
        'Professor', 
        'Aula', 
        'Entrega',
        'Status'
      ];
      
      const data = agendamentos.map(a => [
        new Date(a.data).toLocaleDateString('pt-BR'),
        a.turma,
        a.quantidade.toString(),
        `${a.aparelho} (${a.marca})`,
        a.professor,
        a.aula,
        a.horaEntrega || '--:--',
        a.status === 'entregue' ? 'Entregue' : 
        a.status === 'excluido' ? 'Excluído' : 'Pendente'
      ]);
      
      let csvContent = "data:text/csv;charset=utf-8," 
        + headers.join(";") + "\n" 
        + data.map(row => row.join(";")).join("\n");
      
      const encodedUri = encodeURI(csvContent);
      const link = document.createElement("a");
      link.setAttribute("href", encodedUri);
      link.setAttribute("download", "historico_agendamentos.csv");
      document.body.appendChild(link);
      link.click();
      document.body.removeChild(link);
    }

    // ==============================================
    // FUNÇÕES DE INTEGRAÇÃO COM SISTEMA DE CADASTRO
    // ==============================================

    // Função para verificar disponibilidade de equipamentos
    function verificarDisponibilidade() {
      const aparelho = document.getElementById('aparelho').value;
      const data = document.getElementById('data-selecionada').value;
      const quantidade = document.getElementById('numero-aparelhos').value;
      
      if (!aparelho || !data || !quantidade) return;
      
      const dataISO = new Date(data.split('/').reverse().join('-')).toISOString().split('T')[0];
      
      buscarEquipamentosDisponiveis(aparelho, dataISO, (equipamentos) => {
        const disponiveis = equipamentos.filter(e => e.disponivel).length;
        
        if (disponiveis < quantidade) {
          alert(`Atenção! Há apenas ${disponiveis} ${aparelho}(s) disponível(eis) para a data selecionada.`);
        }
      });
    }

    // Função para buscar equipamentos disponíveis (simulação de API)
    function buscarEquipamentosDisponiveis(tipo, data, callback) {
      // Simulando uma chamada assíncrona à API do sistema de cadastro
      setTimeout(() => {
        const equipamentos = [];
        const quantidadeTotal = tipo === 'TABLET' ? 15 : 
                              tipo === 'NOTEBOOK' ? 10 : 
                              tipo === 'PROJETOR' ? 5 : 8;
        
        // Verificar quantos já estão agendados para esta data
        const agendados = agendamentos.filter(a => 
          a.aparelho === tipo && 
          a.data === data && 
          a.status !== 'excluido' && 
          a.status !== 'entregue'
        ).reduce((total, a) => total + a.quantidade, 0);
        
        const disponiveis = Math.max(0, quantidadeTotal - agendados);
        
        // Gerar lista de equipamentos disponíveis
        for (let i = 1; i <= disponiveis; i++) {
          equipamentos.push({
            id: `${tipo}-${i}`,
            tipo: tipo,
            marca: aparelhosMarcas[tipo],
            modelo: `${tipo} Modelo ${i}`,
            disponivel: true
          });
        }
        
        callback(equipamentos);
      }, 300);
    }

    // Função para verificar disponibilidade no cadastro (síncrona)
    function verificarDisponibilidadeNoCadastro(tipo, quantidade, data) {
      // Em um sistema real, isso seria uma chamada à API do sistema de cadastro
      const quantidadeTotal = tipo === 'TABLET' ? 15 : 
                            tipo === 'NOTEBOOK' ? 10 : 
                            tipo === 'PROJETOR' ? 5 : 8;
      
      // Verificar quantos já estão agendados para esta data
      const agendados = agendamentos.filter(a => 
        a.aparelho === tipo && 
        a.data === data && 
        a.status !== 'excluido' && 
        a.status !== 'entregue'
      ).reduce((total, a) => total + a.quantidade, 0);
      
      return (quantidadeTotal - agendados) >= quantidade;
    }

    // Função para marcar equipamentos como indisponíveis no cadastro
    function marcarEquipamentosIndisponiveis(tipo, quantidade, data) {
      // Em um sistema real, isso seria uma chamada à API do sistema de cadastro
      console.log(`Marcando ${quantidade} ${tipo}(s) como indisponíveis para ${data}`);
      // Implementação real faria a chamada à API para atualizar o status dos equipamentos
    }

    // Função para marcar equipamentos como disponíveis no cadastro
    function marcarEquipamentosDisponiveis(tipo, quantidade, data) {
      // Em um sistema real, isso seria uma chamada à API do sistema de cadastro
      console.log(`Marcando ${quantidade} ${tipo}(s) como disponíveis para ${data}`);
      // Implementação real faria a chamada à API para atualizar o status dos equipamentos
    }

    // Ouvintes de eventos para verificação de disponibilidade
    document.getElementById('aparelho').addEventListener('change', verificarDisponibilidade);
    document.getElementById('data-selecionada').addEventListener('change', verificarDisponibilidade);
    document.getElementById('numero-aparelhos').addEventListener('change', verificarDisponibilidade);
  </script>
</body>
</html>
